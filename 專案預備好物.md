# 好物預備

## 架構

`Extension` 延伸方法，使用 `IsNull()` 或是 `IsObject()`
是要避免 `Unity` 的參考被刪掉不知道是不是 `null` 的問題。

```csharp
static class Extension
{
    public static bool IsNull(this object obj)
    {
        return obj is null || obj.Equals(null);
    }
    public static bool IsObject(this object obj)
    {
        return obj is object && !obj.Equals(null);
    }
    public static string GetJson(this object obj)
    {
        return JsonConvert.Serialize(obj, INDENTED);
    }
    public static string GetObject<T>(this string json)
    {
        return JsonConvert.Deserialize<T>(json);
    }
    
    public static T EnsureComponent<T>(this GameObject obj, out T t) where T : Component
    {
        if (!TryGetComponent(obj, out t)
        {
            t = obj.AddComponent<T>();
        }
        return obj;
    }
    public static GameObject Active(this GameObject obj, bool active)
    {
        obj.SetActive(active);
        return obj;
    }
}
```

`MonoSingleton` 可以隨時呼叫不用初始化

```csharp
public class MonoSingleton<T> : Monobehaviour where T : MonoSingleton<T>
{
    protected static T instance;
    
    public T GetInstance()
    {
        if (instance.IsNull())
        {
            new GameObject(nameof(T))
                .EnsureComponent(out instance);
        }
        return instance;
    }
}
```

`Def` 寫下所有定義檔的區域

```csharp
public class Def
{
    public const string API_KEY = "!@#$%&!@#$%&*";
    
    public const string PROFILES = "profiles";

    public static string readonly PersistentPath = Application.PersistentDataPath;

    public static string GetSaveFilePath<T>()
    {
        string folder = PersistentPath;
        return Path.Combine(folder, "{typeof(T).Name}.afs");
    }
    
    public static string GetProfileFilePath(string name)
    {
        string folder = PersistentPath;
        return Path.Combine(folder, PROFILES, name);
    }
}
```

`SaveTypeService` 讀取與儲存特定檔案類型

```csharp
public static class SaveTypeService
{
    public static async void Save<T>(T model)
    {
        var path = Def.GetSaveFilePath<T>();
        var json = JsonConvert.Serialize(model);
        await File.WritAllTextAsync(path, json);
    }
    
    public static bool TryLoad<T>(out T model)
    {
        try
        {
            var path = Def.GetSaveFilePath<T>();
            var json = File.ReadAllText(path);
            model    = Json.Deserialize<T>(json);
            return model is object;
        }
        catch (Exception ex)
        {
            model = default;
            return false;
        }
    }
}
```

`MVC` 架構下的 `View`
`MVC` 的意思是 `Model`, `View`, `Controller`，
`Model` 是要當要顯示 `View` 時要傳入的參數，
`Controller` 就是控制資料的控制器， `V` 可以傳回資料給 `C`，但
`C` 不要直接改變 `V` 的 `M`。

```csharp
public interface IView
{
    void Show();
    void Hide();
}

public interface IView<TModel>
{   
    void Show<TModel>(TModel show);
    void Show();
    void Hide();
}

public abstract AView<TModel> : IView<TModel>
{
    protected TModel model;
    public virtual Show<TModel>(TModel inModel)
    {
        model = inModel;
        Show();
    }
    public virtual Show()
    {
        gameObject.SetActive(true);
    }
    public virtual Hide()
    {
        gameObject.SetActive(false);
    }
}
``` 

## 包

`JSON` 包，把資料輕鬆轉換成 `JSON` 格式比 Unity 的 `JsonUtility` 再好用一點。

> Add package by name
> com.unity.nuget.newtonsoft-json

`DOTween` 包，讓程式撰寫動畫的方式

> 這個要下載放在 Plugins 中
> https://dotween.demigiant.com/download.php

`UniTask` 包，讓異步變得異常好用

> Add from git URL
> https://github.com/Cysharp/UniTask.git?path=src/UniTask/Assets/Plugins/UniTask

如果要加上 `DOTween` 一起使用要加入 `define symbol`

> UNITASK_DOTWEEN_SUPPORT

`Luban` 包，讓配置讀取靜態 `Excel` 表或稱作 `.xlsx` 檔案

> Add from git URL
> https://github.com/focus-creative-games/luban_unity.git 